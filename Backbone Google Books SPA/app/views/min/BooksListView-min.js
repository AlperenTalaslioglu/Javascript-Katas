window.BooksListView=Backbone.View.extend({initialize:function(){this.template=_.template(template.get("books-list")),this.books=new BooksCollection,this.book=new Book},events:{"change #result-limit":"updateResultsByPageLimit"},updateResultsByPageLimit:function(){var t=Backbone.history.fragment.split("/");this.redirectPage(t[1],0,$("#result-limit").val())},redirectPage:function(t,e,a){window.app.navigate("#books/"+t+"/"+e+"/"+a,!0)},searchBooks:function(t,e,a){$("#loading-indicator").show(),$(".search").hide(),t=t.split("-").join(" "),$("#result-limit").val(a);var i=this,o=this.prepareQueryURL(t,e,a);$.ajax({url:o,dataType:"jsonp",success:function(t){t.totalItems&&t.items&&t.totalItems>0?(_.each(t.items,function(t){i.books.add(new Book(t.volumeInfo))}),i.drawTable(),i.createPagination(e,t.totalItems,a)):t.error?template.throwError(t.error.message):template.throwError("No Results Found!"),$(".search").show(),$("#loading-indicator").hide()},error:function(t){template.throwError(t.message)}})},prepareQueryURL:function(t,e,a){var i="https://www.googleapis.com/books/v1/volumes";return i+="?q="+t,i+="&startIndex="+e,i+="&maxResults="+a},drawTable:function(){this.books.models.forEach(function(t,e){var a='<tr class="search__results-table-body-row">';a+="<td>",a+='<a class="search__result-book-link" href="#book/'+e+"/"+template.encodeSeoUrl(t.attributes.title)+'">',a+=(t.attributes.title?t.attributes.title:"-")+"</a>",a+="</td>",a+="<td>"+(t.attributes.subtitle?t.attributes.subtitle:"-")+"</td>",a+="<td>"+(t.attributes.authors?t.attributes.authors.join():"-")+"</td>",a+="<td>"+(t.attributes.publishedDate?t.attributes.publishedDate:"-")+"</td>",$("#searchBooksListView").append(a)})},createPagination:function(t,e,a){var i=t/a;if(e/a>i){for(var o=0;5>o;o++)$("#pagination").append('<li><a href="'+this.createPaginationUrl(i)+'">'+ ++i+"</a></li>");$("#pagination").prepend("<li><a>&laquo;</a></li>"),$("#pagination").append("<li><a>&raquo;</a></li>")}},createPaginationUrl:function(t){var e=Backbone.history.fragment.split("/");return e[2]=t*parseInt(e[3]),"#"+e.join("/")},getBooks:function(){return this.books},render:function(){return this.$el.html(this.template()),this.el}});